# Für ein Deployment außerhalb einer Vagrant Box muss der Benutzer vagrant ggf.
# durch einen anderen Benutzer ersetzt werden.
#
# Im Verzeichnis /home/vagrant/pyvenv
# muss ein Python 3 venv wie folgt erstellt werden:
#
# $ python3 -m venv /home/vagrant/pyvenv
#
# Das Apache Modul mod_headers muss aktiviert werden.
#
# Folgende Verzeichnisse müssen ggf. erstellt werden und diese, sowie deren
# Unterverzeichnisse, müssen für den Benutzer www-data lesbar sein:
#
# - /home/vagrant/media/
# - /home/vagrant/pyvenv
# - /home/vagrant/static_root/
#
# Außerdem sollte example.com mit dem korrekten Hostnamen ersetzt werden.

<VirtualHost *:80>
    ServerName absys.example.com
    ServerAdmin webmaster@example.com

    CustomLog /var/log/apache2/absys.example.com-access.log common
    ErrorLog /var/log/apache2/absys.example.com-error.log

    DocumentRoot /home/vagrant/static_root/

    # static and media files
    # Alias /favicon.ico /home/vagrant/static_root/favicon.ico
    # Alias /robots.txt /home/vagrant/static_root/robots.txt
    Alias /media/ /home/vagrant/media/
    Alias /static/ /home/vagrant/static_root/

    <Directory /home/vagrant/media>
        Require all granted
        Header set X-Content-Type-Options: nosniff
        Header set X-Frame-Options: deny
        Header set X-XSS-Protection: "1; mode=block"
    </Directory>

    <Directory /home/vagrant/static_root>
        Require all granted
        Header set X-Content-Type-Options: nosniff
        Header set X-Frame-Options: deny
        Header set X-XSS-Protection: "1; mode=block"
    </Directory>

    # WSGI
    WSGIDaemonProcess absys.example.com python-path=/home/vagrant/pyvenv/lib/python3.5/site-packages processes=2 threads=15 display-name=%{GROUP}
    WSGIProcessGroup absys.example.com
    WSGIScriptAlias / /home/vagrant/pyvenv/lib/python3.5/site-packages/absys/config/wsgi.py

    <Directory /home/vagrant/pyvenv/lib/python3.5/site-packages/absys/config>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>
</VirtualHost>
