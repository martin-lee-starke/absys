{% extends "base.html" %}

{% block navigation %}
{% endblock %}


{# DECKBLATT #}

{% block content %}
  <div>
    <h1><b> Rechnung </b></h1>
    <br>
    <h3>
      <b>an</b><br>
      {{ rechnungsozialamt.name_sozialamt }}<br>
      {{ rechnungsozialamt.anschrift_sozialamt|linebreaks }}<br>
      <br>
      <b>von</b><br>
        {{ view.adresse_schule|linebreaks }}
      <br>
      <b>Rechnungsnummer:</b> {{ rechnungsozialamt.nummer }} <br>
      <b>Abrechnungszeitraum:</b>
      {{ rechnungsozialamt.startdatum|date:"SHORT_DATE_FORMAT" }}
      -
      {{ rechnungsozialamt.enddatum|date:"SHORT_DATE_FORMAT" }}<br><br><br>
      <b>Einrichtungen zur Abrechnung: </b>
        {% for einrichtungsrechnung in rechnungsozialamt.rechnungen_einrichtungen.all %}
          {{ einrichtungsrechnung.name_einrichtung }}{% if not forloop.last %},{% endif %}
        {% endfor %}
    </h3>


    {# BEGINN EINRICHTUNGSRECHNUNGEN #}

    {% for einrichtungsrechnung in rechnungsozialamt.rechnungen_einrichtungen.all %}

      <div style="page-break-before:always;"></div>

      <h2> Einrichtung: {{ einrichtungsrechnung.name_einrichtung }} </h2>

      <table class="table" style="border: 0;">
        <tbody style="display: table-row-group">
          <tr>
            <td style="border: 0;">
              <p>
                <b>Anschrift:</b>
                {{ einrichtungsrechnung.einrichtung.standort.anschrift|linebreaks }}
              </p>
            </td>
            <td style="border: 0;">
              <p>
                <b>Zahlungsdaten:</b><br>
                <p>
                  BIC: {{ einrichtungsrechnung.einrichtung.standort.konto_bic }}<br>
                  Institut: {{ einrichtungsrechnung.einrichtung.standort.konto_institut }}<br>
                  IBAN: {{ einrichtungsrechnung.einrichtung.standort.konto_iban }}<br>
                </p>
              </p>
            </td>
          </tr>
          <tr>
            <td style="border: 0;">
              <p>
                <b>Typ der Einrichtung: </b>
                {% if einrichtungsrechnung.einrichtung.konfiguration.tage == 250 %}
                  250-Tages-Einrichtung
                {% elif einrichtungsrechnung.einrichtung.konfiguration.tage == 280 %}
                  280-Tages-Einrichtung
                {% elif einrichtungsrechnung.einrichtung.konfiguration.tage == 365 %}
                  365-Tages-Einrichtung
                {% endif %}
                <br>
                <b>Abrechnungszeitraum:</b>
                {{ rechnungsozialamt.startdatum|date:"SHORT_DATE_FORMAT" }}
                -
                {{ rechnungsozialamt.enddatum|date:"SHORT_DATE_FORMAT" }}
                <br>
                <b>Schließtage:</b>
                {% for schliesstag in einrichtungsrechnung.schliesstage %}
                  {{ schliesstag.datum|date:"SHORT_DATE_FORMAT" }}{% if not forloop.last %},{% endif %}
                {% empty %}
                  keine Schließtage in diesem Zeitraum definiert
                {% endfor %}
                <br>
                <b>Betreuungstage:</b> {{ einrichtungsrechnung.betreuungstage }} <br><br>
                <b>gegenüber:</b>
                <br>
                {{ rechnungsozialamt.sozialamt }} <br>
                {{ rechnungsozialamt.anschrift_sozialamt|linebreaksbr }}
              </p>
            </td>
            <td style="border: 0;">
              <p>
                  <b>Fälligkeitsdatum:</b> {{ einrichtungsrechnung.datum_faellig|date:"SHORT_DATE_FORMAT" }}<br>
                  <br>
                  <b>Buchungskennzeichen: </b>{{ einrichtungsrechnung.buchungskennzeichen }}<br>
                  <br>
                  <b> Das Buchungskennzeichen bitte unbedingt<br>
                  bei der Überweisung angeben!</b><br>
                  <br>
                <h4><b>Aufwendungen Gesamt: {{ einrichtungsrechnung.summe }} € </b></h4><br><br>
              </p>
            </td>
          </tr>
        </tbody>
      </table>

      <hr>

      {# BEGINN EINRICHTUNGSPOSITIONEN UEBERSICHTSLISTE PRO EINRICHTUNG #}

      <table class="table table-striped">
        <thead style="display: table-row-group">
           <tr>
            <th>Pos.</th>

            <th>Name</th>

            <th>Aktenzeichen</th>

            <th>Geburtsdatum</th>

            {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
              <th>Maximale Fehltage</th>
            {% endif %}

            <th>Anzahl Tage anwesend</th>

            {% if einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
              <th>Betrag Anwesenheit</th>
            {% endif %}

            <th>Fehltage im Abrechnungs-zeitraum</th>

            {% if einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
              <th>Betrag Abwesenheit</th>
            {% endif %}

            {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
              <th>Übertrag Fehltage</th>
            {% endif %}

            {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
              <th>Fehltage Gesamt</th>
            {% endif %}

            {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
              <th>Fehltage zur Anrechnung</th>
            {% endif %}

            <th>Zahltage dieser Rechnung</th>

            {% if einrichtungsrechnung.einrichtung.konfiguration.bargeldauszahlung %}
              <th>Barbetrag</th>
            {% endif %}

            {% if einrichtungsrechnung.einrichtung.konfiguration.bekleidungsgeld %}
              <th>Bekleidungsgeld</th>
            {% endif %}

            <th>Gesamtbetrag in Euro</th>
          </tr>
        </thead>
        <tbody>
          {% for einrichtungsposition in einrichtungsrechnung.positionen.all %}
            <tr>
              <td>{{ forloop.counter }}</td>

              <td>{{ einrichtungsposition.name_schueler }}</td>

              <td>{{ einrichtungsposition.schueler.aktenzeichen }}</td>

              <td>{{ einrichtungsposition.schueler.geburtsdatum|date:"SHORT_DATE_FORMAT" }}</td>

              {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                <td>{{ einrichtungsposition.fehltage_max }}</td>
              {% endif %}

              <td>{{ einrichtungsposition.anwesend }}</td>

              {% if einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                <td>{{ einrichtungsposition.anwesenheitssumme }}</td>
              {% endif %}

              <td>{{ einrichtungsposition.fehltage }}</td>

              {% if einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                <td>{{ einrichtungsposition.abwesenheitssumme }}</td>
              {% endif %}

              {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                <td>{{ einrichtungsposition.fehltage_uebertrag }}</td>
              {% endif %}

              {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                <td>{{ einrichtungsposition.fehltage_gesamt }}</td>
              {% endif %}

              {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                <td>{{ einrichtungsposition.fehltage_abrechnung }}</td>
              {% endif %}

              <td>{{ einrichtungsposition.zahltage }}</td>
              
              {% if einrichtungsrechnung.einrichtung.konfiguration.bargeldauszahlung %}
                <td>{{ einrichtungsposition.bargeldbetrag }}</td>
              {% endif %}

              {% if einrichtungsrechnung.einrichtung.konfiguration.bekleidungsgeld %}
                <td>{{ einrichtungsposition.bekleidungsgeld }}</td>
              {% endif %}
              
              <td>{{ einrichtungsposition.summe }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      {# ENDE EINRICHTUNGSPOSITIONEN UEBERSICHTSLISTE PRO EINRICHTUNG #}

      {# BEGINN SCHUELERPOSITIONEN #}

      <div style="page-break-before:always;"></div>

        {% if einrichtungsrechnung.einrichtung.konfiguration.tage == 365 %}
          <h4> PLATZHALTER ANWESENHEITSLISTE MIT -3 und +3 Tagen </h4>
        {% endif %}

        <div style="page-break-before:always;"></div>

        {% for einrichtungsposition in einrichtungsrechnung.positionen.all %}

          <div style="page-break-before:always;"></div>

        {# BEGINN KOPF DER SCHUELERPOSITIONEN #}
          <h3> Schülerposition {{ forloop.counter }} </h3>
          <h4> ({{ einrichtungsposition.name_schueler }}
            in {{ einrichtungsposition.rechnung_einrichtung.name_einrichtung }}
            vom {{ rechnungsozialamt.startdatum|date:"SHORT_DATE_FORMAT" }} bis
            {{ rechnungsozialamt.enddatum|date:"SHORT_DATE_FORMAT" }})
          </h4>

          <table class="table table-striped">
            <thead style="display: table-row-group">
              <tr>
                <th>Aktenzeichen</th>

                <th>Geburtsdatum</th>

                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <th>Maximale Fehltage</th>
                {% endif %}

                <th>Anzahl Tage anwesend</th>

                {% if einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <th>Betrag Anwesenheit</th>
                {% endif %}

                <th>Fehltage im Abrechnungs-zeitraum</th>
                
                {% if einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <th>Betrag Abwesenheit</th>
                {% endif %}

                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <th>Übertrag abgerechnete Fehltage</th>
                {% endif %}

                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <th>Fehltage Gesamt</th>
                {% endif %}

                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <th>Fehltage zur Abrechnung</th>
                {% endif %}

                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <th>davon Fehltage nachträglich zur Abrechnung</th>
                {% endif %}

                <th>Zahltage dieser Rechnung</th>

                {% if einrichtungsrechnung.einrichtung.konfiguration.bargeldauszahlung %}
                  <th>Barbetrag</th>
                {% endif %}

                {% if einrichtungsrechnung.einrichtung.konfiguration.bekleidungsgeld %}
                  <th>Bekleidungsgeld</th>
                {% endif %}

                <th>Gesamtbetrag in Euro</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{ einrichtungsposition.schueler.aktenzeichen }}</td>

                <td>{{ einrichtungsposition.schueler.geburtsdatum|date:"SHORT_DATE_FORMAT" }}</td>

                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <td>{{ einrichtungsposition.fehltage_max }}</td>
                {% endif %}

                <td>{{ einrichtungsposition.anwesend }}</td>

                {% if einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <td>{{ einrichtungsposition.anwesenheitssumme }}</td>
                {% endif %}

                <td>{{ einrichtungsposition.fehltage }}</td>

                {% if einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <td>{{ einrichtungsposition.abwesenheitssumme }}</td>
                {% endif %}

                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <td>{{ einrichtungsposition.fehltage_uebertrag }}</td>
                {% endif %}
                
                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <td>{{ einrichtungsposition.fehltage_gesamt }}</td>
                {% endif %}

                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <td>{{ einrichtungsposition.fehltage_abrechnung }}</td>
                {% endif %}

                {% if not einrichtungsrechnung.einrichtung.konfiguration.fehltage_immer_abrechnen %}
                  <td>{{ einrichtungsposition.fehltage_anderer_zeitraum }}</td>
                {% endif %}

                <td>{{ einrichtungsposition.zahltage }}</td>

                {% if einrichtungsrechnung.einrichtung.konfiguration.bargeldauszahlung %}
                  <td>{{ einrichtungsposition.bargeldbetrag }}</td>
                {% endif %}

                {% if einrichtungsrechnung.einrichtung.konfiguration.bekleidungsgeld %}
                  <td>{{ einrichtungsposition.bekleidungsgeld }}</td>
                {% endif %}

                <td>{{ einrichtungsposition.summe }}</td>
              </tr>
            </tbody>
          </table>
        {# ENDE KOPF DER SCHUELERPOSITIONEN #}

        {# BEGINN ANWESENHEITSAUFLISTUNG #}

          <h4> - Abgerechnete Tage - </h4>
          <table class="table table-striped">
            <thead style="display: table-row-group">
               <tr>
                <th>Datum</th>
                <th>Tagart</th>
                <th>Anwesenheit</th>

                {% if einrichtungsrechnung.einrichtung.konfiguration.tage == 365 %}
                  <th>Bettengeldsatz</th>
                {% endif %}

                <th>
                  Angewendete(r) Pflegesatz
                  {% if einrichtungsrechnung.einrichtung.konfiguration.tage == 280 %} / Abwesenheitsvergütung{% endif %}
                  {% if einrichtungsrechnung.einrichtung.konfiguration.tage == 365 %} / (Vermindertes) Bettengeld{% endif %}
                </th>

              </tr>
            </thead>
            <tbody>
              {% for schuelerposition in einrichtungsposition.detailabrechnung.all %}
                <tr>
                  <td>{{ schuelerposition.datum|date:"SHORT_DATE_FORMAT" }} </td>
                  <td>{{ schuelerposition.tag_art }}</td>
                  <td>
                    {% if schuelerposition.abwesend %}Fehltag
                    {% else %}<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>{% endif %}</td>

                  {% if einrichtungsrechnung.einrichtung.konfiguration.tage == 365 %}
                    <td>
                      {% if schuelerposition.vermindert %}vermindert
                      {% else %}normal
                      {% endif %}
                  {% endif %}

                  <td>{{ schuelerposition.pflegesatz }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endfor %}
      {% endfor %}

    {# ENDE DER ANWESENHEITSAUFLISTUNG #}

    {#ENDE EINRICHTUNGSRECHNUNG #}

    <br><br><br><br>
    <hr>
    <h3> <center> ENDE DER SOZIALAMTRECHNUNG {{ rechnungsozialamt.nummer }}
      FÜR DEN ZEITRAUM VOM {{ rechnungsozialamt.startdatum|date:"SHORT_DATE_FORMAT" }}
      BIS {{ rechnungsozialamt.enddatum|date:"SHORT_DATE_FORMAT" }} </center></h3>
  </div>
{% endblock %}


