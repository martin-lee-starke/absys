{% extends "base.html" %}

{% block navigation %}
  {% block toggle_login %}
  {% endblock %}
{% endblock %}

{# DECKBLATT #}

{% block content %}
<div>
<h1> Rechnung </h1>
<br>
<br>
<br>
<br>
<p>
  Sozialamt: <br>
  {{ rechnungsozialamt.sozialamt }}<br>
  {{ rechnungsozialamt.sozialamt_anschrift }}<br>
  <br>
  Bankverbindung<br>
  {{ rechnungsozialamt.sozialamt.konto_iban }}<br>
  {{ rechnungsozialamt.sozialamt.konto_institut }}<br>
  <br>
  Rechnungsnummer: {{ rechnungsozialamt.nummer }} <br>
  Abrechnungszeitraum:
  {{ rechnungsozialamt.startdatum|date:"d.m.Y" }}
  -
  {{ rechnungsozialamt.enddatum|date:"d.m.Y" }}
</p>

{# ÜBERSICHTSBLÄTTER #}

<div style="page-break-before:always;">
  <h4>Übersicht</h4>
</div>

<p>
  <table class="table table-striped">
    <thead style="display: table-row-group">
       <tr>
        <th>PKZ</th>
        <th>AZ</th>
        <th>Name</th>
        <th>Gesamtbetrag</th>
      </tr>
    </thead>
    <tbody>
      {% for rechnung in rechnungsozialamt.rechnungen_schueler.all %}
        <tr>
          <td>{{ rechnung.schueler.pkz }}</td>
          <td>{{ rechnung.schueler.aktenzeichen }}</td>
          <td>{{ rechnung.name_schueler }}</td>
          <td>{{ rechnung.summe }} €</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</p>

<h4 style="text-align:right">Rechnungsbetrag: {{ rechnungsozialamt.rechnungsbetrag }} €</h4>

{# DECKBLATT EINZELABRECHNUNGEN #}

<div style="page-break-before:always;">
  <h4>Einzelabrechnungen nach Schülern</h4>
</div>

{# EINZELABRECHNUNGEN #}

<div style="page-break-before:always;"></div>

{% for rechnung in rechnungsozialamt.rechnungen_schueler.all %}
<div style="page-break-before:always;">
  <p>
      Schueler: {{ rechnung.name_schueler }}
      <br>
      Summe aller Abrechnungstage: {{ rechnung.summe }}
      <br>
      Fehltage im Abrechnungszeitraum: {{ rechnung.fehltage }}
      <br>
      Anzahl Fehltage nicht abgerechnet: {{ rechnung.fehltage_nicht_abgerechnet.count }}
      <br>
      Fehltage nicht abgerechnet: {% spaceless %}
      {% for fehltag in rechnung.fehltage_nicht_abgerechnet.all %}
        {{ fehltag.datum }}{% if not forloop.last %},{% endif %}
      {% empty %}
        Keine
      {% endfor %}
      {% endspaceless %}
  </p>

      <table class="table table-striped">
        <thead style="display: table-row-group">
           <tr>
            <th>Datum</th>
            <th>Tagart</th>
            <th>Anwesenheit</th>
            <th>Pflegesatz</th>
            <th>Einrichtung</th>
          </tr>
        </thead>
        <tbody>
          {% for position in rechnung.positionen.all %}
            <tr>
              <td>{{ position.datum|date:"d.m.Y" }}</td>
              <td>{{ position.tag_art }}</td>
              <td>{% if position.abwesend %}<span class="glyphicon glyphicon-remove" aria-hidden="true">
                {% else %}<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>{% endif %}</td>
              <td>{{ position.pflegesatz }}</td>
              <td>{{ position.name_einrichtung }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
</div>
{% endfor %}

{% endblock %}
